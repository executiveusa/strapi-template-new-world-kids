# ================================================================================
# DOCKER COMPOSE ENVIRONMENT CONFIGURATION
# ================================================================================
# This file contains Docker-specific environment variables for containers.
# Copy to docker-compose.env and customize for your deployment.
# ================================================================================

# ============================================
# COMPOSE CONFIGURATION
# ============================================
COMPOSE_PROJECT_NAME=newworldkids
COMPOSE_FILE=docker-compose.yml
DOCKER_BUILDKIT=1
COMPOSE_DOCKER_CLI_BUILD=1

# ============================================
# CONTAINER CONFIGURATIONS
# ============================================

# --- Web Application ---
WEB_CONTAINER_NAME=nwk-web
WEB_PORT=3000
WEB_REPLICAS=1
WEB_MEMORY_LIMIT=1g
WEB_MEMORY_RESERVATION=512m
WEB_CPU_LIMIT=1.0
WEB_CPU_RESERVATION=0.25

# --- Database (PostgreSQL) ---
DB_CONTAINER_NAME=nwk-postgres
DB_PORT=5432
DB_MEMORY_LIMIT=2g
DB_MEMORY_RESERVATION=1g
DB_CPU_LIMIT=2.0
DB_CPU_RESERVATION=0.5
POSTGRES_USER=postgres
POSTGRES_PASSWORD=your-secure-postgres-password
POSTGRES_DB=newworldkids
POSTGRES_INITDB_ARGS=--encoding=UTF-8 --locale=en_US.UTF-8
PGDATA=/var/lib/postgresql/data/pgdata

# --- Redis Cache ---
REDIS_CONTAINER_NAME=nwk-redis
REDIS_PORT=6379
REDIS_MEMORY_LIMIT=512m
REDIS_MEMORY_RESERVATION=256m
REDIS_CPU_LIMIT=0.5
REDIS_CPU_RESERVATION=0.1
REDIS_PASSWORD=your-secure-redis-password
REDIS_MAXMEMORY=256mb
REDIS_MAXMEMORY_POLICY=allkeys-lru

# --- Ghost CMS (optional self-hosted) ---
GHOST_CONTAINER_NAME=nwk-ghost
GHOST_PORT=2368
GHOST_MEMORY_LIMIT=1g
GHOST_MEMORY_RESERVATION=512m
GHOST_URL=http://localhost:2368
GHOST_DATABASE_CLIENT=mysql
GHOST_DATABASE_HOST=nwk-mysql
GHOST_DATABASE_NAME=ghost
GHOST_DATABASE_USER=ghost
GHOST_DATABASE_PASSWORD=your-secure-ghost-db-password

# --- Nginx Reverse Proxy ---
NGINX_CONTAINER_NAME=nwk-nginx
NGINX_HTTP_PORT=80
NGINX_HTTPS_PORT=443
NGINX_MEMORY_LIMIT=256m
NGINX_MEMORY_RESERVATION=128m

# --- Prometheus Monitoring ---
PROMETHEUS_CONTAINER_NAME=nwk-prometheus
PROMETHEUS_PORT=9090
PROMETHEUS_MEMORY_LIMIT=512m
PROMETHEUS_RETENTION_TIME=15d
PROMETHEUS_STORAGE_PATH=/prometheus

# --- Grafana Dashboard ---
GRAFANA_CONTAINER_NAME=nwk-grafana
GRAFANA_PORT=3001
GRAFANA_MEMORY_LIMIT=512m
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=your-secure-grafana-password
GRAFANA_PLUGINS=grafana-clock-panel,grafana-simple-json-datasource

# ============================================
# VOLUME PATHS
# ============================================
# Host paths for persistent data
DATA_PATH=./data
LOGS_PATH=./logs
BACKUPS_PATH=./backups

# PostgreSQL data
POSTGRES_DATA_PATH=${DATA_PATH}/postgres

# Redis data
REDIS_DATA_PATH=${DATA_PATH}/redis

# Ghost content
GHOST_CONTENT_PATH=${DATA_PATH}/ghost/content

# Prometheus data
PROMETHEUS_DATA_PATH=${DATA_PATH}/prometheus

# Grafana data
GRAFANA_DATA_PATH=${DATA_PATH}/grafana

# Nginx logs
NGINX_LOGS_PATH=${LOGS_PATH}/nginx

# SSL certificates
SSL_CERTS_PATH=./certs

# ============================================
# NETWORK CONFIGURATION
# ============================================
NETWORK_NAME=nwk-network
NETWORK_DRIVER=bridge
NETWORK_SUBNET=172.28.0.0/16
NETWORK_GATEWAY=172.28.0.1

# Static IPs (optional)
WEB_IP=172.28.0.10
DB_IP=172.28.0.20
REDIS_IP=172.28.0.30
NGINX_IP=172.28.0.2

# ============================================
# HEALTH CHECK CONFIGURATION
# ============================================
# Intervals in seconds
HEALTHCHECK_INTERVAL=30s
HEALTHCHECK_TIMEOUT=10s
HEALTHCHECK_RETRIES=3
HEALTHCHECK_START_PERIOD=40s

# ============================================
# RESTART POLICIES
# ============================================
# Options: no, always, on-failure, unless-stopped
RESTART_POLICY=unless-stopped
RESTART_MAX_ATTEMPTS=5
RESTART_WINDOW=120s

# ============================================
# LOGGING CONFIGURATION
# ============================================
LOG_DRIVER=json-file
LOG_MAX_SIZE=100m
LOG_MAX_FILE=5

# Syslog (alternative)
# LOG_DRIVER=syslog
# SYSLOG_ADDRESS=udp://localhost:514
# SYSLOG_TAG=newworldkids

# ============================================
# BUILD ARGUMENTS
# ============================================
NODE_VERSION=22
ALPINE_VERSION=3.19
BUILD_TARGET=production
SKIP_PREFLIGHT_CHECK=true

# ============================================
# ENVIRONMENT-SPECIFIC
# ============================================
# Development
DEV_MOUNT_SOURCE=true
DEV_HOT_RELOAD=true

# Production
PROD_OPTIMIZE_IMAGES=true
PROD_MINIFY=true

# ============================================
# SECRETS (Docker Swarm)
# ============================================
# When using Docker Swarm, reference secrets like this:
# DB_PASSWORD_FILE=/run/secrets/db_password
# REDIS_PASSWORD_FILE=/run/secrets/redis_password

# ============================================
# TRAEFIK (Alternative to Nginx)
# ============================================
TRAEFIK_ENABLE=false
TRAEFIK_DOMAIN=your-domain.com
TRAEFIK_ACME_EMAIL=admin@your-domain.com
TRAEFIK_ENTRYPOINTS=web,websecure

# ============================================
# BACKUP CONFIGURATION
# ============================================
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * *
BACKUP_RETENTION_DAYS=30
BACKUP_S3_BUCKET=your-backup-bucket
BACKUP_ENCRYPTION_KEY=your-backup-encryption-key

# ================================================================================
# END OF DOCKER COMPOSE CONFIGURATION
# ================================================================================
